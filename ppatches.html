<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>P-Patches Time Slider (Import by URL)</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />

<style>
  body { margin:0; padding:0; }
  #map { width:100%; height:90vh; }
  #slider-container {
      width: 90%;
      margin: 15px auto;
      text-align: center;
  }
  #year-value { font-weight: bold; }
</style>
</head>

<body>

<div id="map"></div>

<div id="slider-container">
  <input id="year-slider" type="range" min="1970" max="2025" step="1" value="1970" />
  <div>Showing p-patches established by: <span id="year-value">1970</span></div>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiaHJraXJzaCIsImEiOiJjbWg1OTJ3NnIwM2p3MmxvZThnNGp6b3htIn0.mZMPWlVv49G_2YIZjqy6hA';

// Initialize Map
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [-122.335, 47.62],
    zoom: 10
});

// Load GeoJSON and add layer
map.on('load', () => {
    map.addSource('ppatches', {
        type: 'geojson',
        data: { "type": "FeatureCollection", "features": [] }
    });

    map.addLayer({
        id: 'ppatches-layer',
        type: 'circle',
        source: 'ppatches',
        paint: {
            'circle-radius': 6,
            'circle-color': '#FF5722',
            'circle-stroke-width': 1,
            'circle-stroke-color': '#333'
        }
    });

    // Initial filter
    map.setFilter('ppatches-layer', ['<=', ['get', 'DATE_ESTAB'], 1970]);

    loadGeoJSON("P_Patches.geojson");
});

// Load GeoJSON from a URL

async function loadGeoJSON(url) {
    try {
        const response = await fetch(url);
        const data = await response.json();
        map.getSource('ppatches').setData(data);

        console.log("Loaded dataset:", data);
    } catch (err) {
        console.error("Failed to load GeoJSON:", err);
    }
}


// Create slider

const slider = document.getElementById('year-slider');
const yearValue = document.getElementById('year-value');

slider.addEventListener('input', (e) => {
    const year = parseInt(e.target.value);
    yearValue.textContent = year;

    map.setFilter('ppatches-layer', [
        "<=",
        ["get", "DATE_ESTAB"],
        year
    ]);
});
</script>

</body>
</html>
